<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title>FHE FIGHTER II</title>
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
    <style>
    @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
    
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: 'Press Start 2P', cursive;
        background: #000;
        color: #fff;
        overflow-x: hidden;
        /* Allow vertical scrolling only if absolutely necessary, but try to prevent it */
        overflow-y: auto; 
        image-rendering: pixelated;
        user-select: none;
    }

    .crt-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        background: repeating-linear-gradient(
            0deg,
            rgba(0, 0, 0, 0.15),
            rgba(0, 0, 0, 0.15) 1px,
            transparent 1px,
            transparent 2px
        );
        z-index: 1000;
    }

    .game-container {
        width: 100%;
        /* max-width: 800px; REMOVED FOR BETTER MOBILE FIT */
        margin: 0 auto;
        padding: 5px; /* Reduced padding */
        position: relative;
    }

    .header {
        background: linear-gradient(180deg, #1a4d8f 0%, #0d2847 100%);
        border: 4px solid #ffd700;
        padding: 10px; /* Reduced padding */
        margin-bottom: 10px;
        box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
    }

    .title {
        font-size: 20px; /* Reduced font size */
        text-align: center;
        color: #ffd700;
        text-shadow: 2px 2px 0 #ff0000, 4px 4px 0 #000; /* Reduced shadow */
        margin-bottom: 5px;
        animation: glow 2s ease-in-out infinite;
    }

    @keyframes glow {
        0%, 100% { text-shadow: 2px 2px 0 #ff0000, 4px 4px 0 #000, 0 0 8px #ffd700; }
        50% { text-shadow: 2px 2px 0 #ff0000, 4px 4px 0 #000, 0 0 20px #ffd700; }
    }

    .stats-bar {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 5px; /* Reduced gap */
        font-size: 8px; /* Reduced font size */
        margin-top: 5px;
    }

    .stat-item {
        background: rgba(0, 0, 0, 0.7);
        padding: 5px; /* Reduced padding */
        border: 2px solid #00ff00;
    }

    .timer-display {
        font-size: 24px; /* Reduced font size */
        color: #00ff00;
        text-align: center;
        margin: 5px 0; /* Reduced margin */
        text-shadow: 0 0 8px #00ff00;
    }

    .timer-display.warning {
        color: #ffff00;
        animation: pulse 0.5s infinite;
    }

    .timer-display.danger {
        color: #ff0000;
        animation: pulse 0.3s infinite;
    }

    @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
    }

    .score-display {
        font-size: 20px; /* Reduced font size */
        color: #ffd700;
        text-align: center;
        text-shadow: 2px 2px 0 #ff0000;
    }

    .multipliers {
        display: flex;
        justify-content: center;
        gap: 5px; /* Reduced gap */
        flex-wrap: wrap;
        min-height: 20px; /* Reduced min-height */
        margin-top: 5px;
    }

    .multiplier {
        background: #ff00ff;
        color: #fff;
        padding: 3px 6px; /* Reduced padding */
        border: 2px solid #fff;
        font-size: 6px; /* Reduced font size */
        animation: bounce 0.5s;
        box-shadow: 0 0 8px #ff00ff;
    }

    @keyframes bounce {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-5px); }
    }

    .arena {
        background: linear-gradient(180deg, #2a5298 0%, #1e3a5f 50%, #8b4513 100%);
        border: 4px solid #8b4513; /* Reduced border */
        padding: 10px; /* Reduced padding */
        min-height: 250px; /* Reduced min-height for mobile */
        position: relative;
        margin-bottom: 10px;
        box-shadow: inset 0 0 30px rgba(0, 0, 0, 0.5);
    }

    .choices {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 8px; /* Reduced gap */
        margin-top: 10px;
    }

    .choice-card {
        background: linear-gradient(180deg, #4a90e2 0%, #2563eb 100%);
        border: 3px solid #ffd700; /* Reduced border */
        padding: 10px 5px; /* Reduced padding */
        text-align: center;
        cursor: pointer;
        position: relative;
        transition: transform 0.1s, opacity 0.3s ease-in-out; /* Added opacity transition */
        font-size: 8px; /* Reduced font size */
        line-height: 1.4;
        min-height: 80px; /* Reduced min-height */
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 3px 0 #996600, 0 6px 10px rgba(0, 0, 0, 0.5);
    }

    .choice-card:hover {
        transform: translateY(-3px) scale(1.03);
        box-shadow: 0 4px 0 #996600, 0 8px 15px rgba(255, 215, 0, 0.6);
    }

    .choice-card:active {
        transform: translateY(1px);
        box-shadow: 0 1px 0 #996600;
    }

    /* New CSS for floating score */
    .floating-score {
        position: fixed; /* Fixed position relative to viewport */
        color: #fff;
        text-shadow: 2px 2px 0 #ff00ff;
        font-size: 16px;
        font-weight: bold;
        pointer-events: none;
        animation: float-up-fade 1s forwards;
        z-index: 1001;
    }

    @keyframes float-up-fade {
        0% { transform: translateY(0); opacity: 1; }
        100% { transform: translateY(-50px); opacity: 0; }
    }

    .explosion {
        position: absolute;
        font-size: 40px; /* Reduced font size */
        animation: explode 0.6s forwards;
        pointer-events: none;
    }

    @keyframes explode {
        0% { transform: scale(0) rotate(0deg); opacity: 1; }
        50% { transform: scale(1) rotate(180deg); opacity: 1; }
        100% { transform: scale(1.5) rotate(360deg); opacity: 0; }
    }

    .instruction {
        text-align: center;
        font-size: 10px; /* Reduced font size */
        color: #ffff00;
        margin-bottom: 10px;
        text-shadow: 1px 1px 0 #000;
        animation: blink 1.5s infinite;
    }

    @keyframes blink {
        0%, 49% { opacity: 1; }
        50%, 100% { opacity: 0.3; }
    }

    .results-screen {
        background: linear-gradient(180deg, #1a1a2e 0%, #16213e 100%);
        border: 4px solid #ffd700; /* Reduced border */
        padding: 20px; /* Reduced padding */
        text-align: center;
        display: none;
    }

    .results-screen.active {
        display: block;
    }

    .final-score {
        font-size: 32px; /* Reduced font size */
        color: #ffd700;
        margin: 10px 0;
        text-shadow: 2px 2px 0 #ff0000;
    }

    .top-picks {
        background: rgba(0, 0, 0, 0.5);
        border: 2px solid #00ff00;
        padding: 10px;
        margin: 10px 0;
        text-align: left;
    }

    .top-picks h3 {
        color: #00ff00;
        font-size: 12px;
        margin-bottom: 10px;
        text-align: center;
    }

    .top-picks ol {
        list-style: none;
        counter-reset: item;
    }

    .top-picks li {
        counter-increment: item;
        padding: 5px;
        margin: 5px 0;
        background: rgba(255, 255, 255, 0.1);
        border-left: 3px solid #ffd700;
        font-size: 9px;
    }

    .top-picks li:before {
        content: counter(item) ". ";
        color: #ffd700;
        font-weight: bold;
        margin-right: 5px;
    }

    .high-scores {
        background: rgba(0, 0, 0, 0.7);
        border: 2px solid #ff00ff;
        padding: 10px;
        margin: 10px 0;
    }

    .high-scores h3 {
        color: #ff00ff;
        font-size: 12px;
        margin-bottom: 10px;
    }

    .high-score-entry {
        display: flex;
        justify-content: space-between;
        padding: 5px;
        margin: 3px 0;
        border-bottom: 1px solid #444;
        font-size: 8px;
    }

    .arcade-button {
        background: linear-gradient(180deg, #ff0000 0%, #cc0000 100%);
        color: #fff;
        border: 3px solid #fff;
        padding: 10px 20px;
        font-family: 'Press Start 2P', cursive;
        font-size: 10px;
        cursor: pointer;
        margin: 5px;
        box-shadow: 0 4px 0 #800000, 0 6px 15px rgba(0, 0, 0, 0.5);
        transition: transform 0.1s;
    }

    .arcade-button:hover {
        transform: translateY(-1px);
        box-shadow: 0 5px 0 #800000, 0 8px 20px rgba(255, 0, 0, 0.5);
    }

    .arcade-button:active {
        transform: translateY(2px);
        box-shadow: 0 2px 0 #800000;
    }

    .arcade-button.secondary {
        background: linear-gradient(180deg, #4a90e2 0%, #2563eb 100%);
        box-shadow: 0 4px 0 #1e40af, 0 6px 15px rgba(0, 0, 0, 0.5);
    }

    .arcade-button.secondary:hover {
        box-shadow: 0 5px 0 #1e40af, 0 8px 20px rgba(37, 99, 235, 0.5);
    }

    .arcade-button.secondary:active {
        box-shadow: 0 2px 0 #1e40af;
    }

    .progress-text {
        text-align: center;
        font-size: 10px;
        color: #ffff00;
        margin-top: 5px;
    }

    .name-input-screen {
        background: linear-gradient(180deg, #1a1a2e 0%, #16213e 100%);
        border: 4px solid #ffd700;
        padding: 20px;
        text-align: center;
        margin-top: 20px;
    }

    .name-input-screen h2 {
        font-size: 14px;
        color: #ffd700;
        margin-bottom: 15px;
    }

    .name-input-screen input {
        background: rgba(0, 0, 0, 0.7);
        border: 2px solid #00ff00;
        color: #00ff00;
        font-family: 'Press Start 2P', cursive;
        font-size: 12px;
        padding: 10px;
        width: 100%;
        max-width: 250px;
        text-align: center;
        margin-bottom: 15px;
    }

    .screenshot-area {
        background: linear-gradient(180deg, #1a4d8f 0%, #0d2847 100%);
        border: 4px solid #ffd700;
        padding: 20px;
        margin: 10px auto;
        max-width: 400px;
    }

    /* Small screen adjustments - applied broadly to help with fit */
    @media (max-width: 600px) {
        .game-container { padding: 5px; }
        .header { padding: 8px; }
        .title { font-size: 16px; }
        .timer-display { font-size: 20px; }
        .score-display { font-size: 16px; }
        .arena { padding: 8px; min-height: 200px; }
        .choices { gap: 5px; }
        .choice-card { font-size: 7px; min-height: 70px; padding: 5px; }
        .stats-bar { grid-template-columns: 1fr; } /* Single column on mobile */
    }

    </style>
</head>
<body>
    <div class="crt-overlay"></div>
    <div class="game-container" id="gameContainer">
        
        <div class="name-input-screen" id="nameInputScreen">
            <h2>ENTER YOUR NAME</h2>
            <input type="text" id="playerName" maxlength="10" placeholder="PLAYER1" />
            <div>
                <button class="arcade-button" onclick="startGame()">START GAME</button>
            </div>
        </div>

        <div id="gameScreen" style="display: none;">
            <div class="header">
                <div class="title">FHE FIGHTER II</div>
                <div class="timer-display" id="timer">15.00</div>
                <div class="score-display" id="score">SCORE: 0</div>
                <div class="multipliers" id="multipliers"></div>
                <div class="stats-bar">
                    <div class="stat-item">REMAINING: <span id="remainingCount">30</span></div>
                    <div class="stat-item">FAVORITES: <span id="favsCount">0</span></div>
                </div>
            </div>

            <div class="arena">
                <div class="instruction">TAP TO CHOOSE YOUR FAVORITE!</div>
                <div class="choices" id="choices"></div>
                <div class="progress-text" id="progressText"></div>
            </div>
        </div>

        <div class="results-screen" id="resultsScreen">
            <div class="screenshot-area" id="screenshotArea">
                <div class="title">GAME OVER</div>
                <div class="final-score" id="finalScore">0</div>
                <div style="font-size: 14px; color: #ffd700; margin: 10px 0;" id="playerNameDisplay"></div>
                
                <div class="top-picks">
                    <h3>YOUR TOP 5 ACTIVITIES</h3>
                    <ol id="topPicksList"></ol>
                </div>
            </div>

            <div class="high-scores">
                <h3>HIGH SCORES</h3>
                <div id="highScoresList"></div>
            </div>

            <div>
                <button class="arcade-button secondary" onclick="shareScore()">SHARE SCORE</button>
                <button class="arcade-button" onclick="resetGame()">PLAY AGAIN</button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script>
    const GOOGLE_SHEET_URL = 'https://script.google.com/macros/s/AKfycbwjPdmkcpuRZJeQjdF53ZvPsILjnnecRAIfdbV1qqJ3knO-Kgx5IJNz557hrxIs80G3/exec';
    
    const ACTIVITIES = [
        "Board Games", "Nature Walk", "Nerf Guns", "Family Feud", "Charades", 
        "Nursing Home", "Small Group Dinners", "Local Band", "Frisbee Golf", 
        "Capture The Flag", "Thrift Swap", "Cookie Decorating", "Four Square", 
        "Volleyball", "Poetry Slam", "Pancakes", "AI Workshop", "Career Panel", 
        "Meal Delivery", "Dodgeball", "Mental Health", "Karaoke Night", 
        "City Council Meeting", "Burn Stuff", "Sardines", "PowerPoint Night",
        "Pickleball", "Arts & Crafts", "Chair Soccer", "Video Games"
    ];

    const FAKE_HIGH_SCORES = [
        { name: "RYU", score: 8750 },
        { name: "D&C", score: 8200 },
        { name: "JST", score: 7890 },
        { name: "ROUGE", score: 7450 },
        { name: "YSA", score: 7100 },
        { name: "DALLIN", score: 6800 },
        { name: "AMY", score: 6550 },
        { name: "1820", score: 6200 }
    ];

    let gameState = {
        playerName: '',
        score: 0,
        current: [],           // Items waiting to be shown this round
        evaluating: [],        // Current batch being evaluated
        survived: [],          // Items that survived this round so far
        eliminated: {},        // Items eliminated: {id: {eliminatedBy: [ids]}}
        favorites: [],         // Final top 5 list
        timer: 15,
        timerInterval: null,
        highScores: [...FAKE_HIGH_SCORES]
    };

    const BATCH_SIZE = 3;

    function shuffle(array) {
        const arr = [...array];
        for (let i = arr.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [arr[i], arr[j]] = [arr[j], arr[i]];
        }
        return arr;
    }

    function getAvailableItems() {
        return ACTIVITIES.filter(id => 
            !gameState.favorites.includes(id) && 
            !gameState.eliminated[id]
        );
    }

    function startGame() {
        const nameInput = document.getElementById('playerName').value.trim() || 'PLAYER1';
        gameState.playerName = nameInput.toUpperCase().slice(0, 10);
        
        document.getElementById('nameInputScreen').style.display = 'none';
        document.getElementById('gameScreen').style.display = 'block';
        
        startNewRound();
    }

    function startNewRound() {
        const available = getAvailableItems();
        
        if (available.length === 0) {
            // All done!
            endGame();
            return;
        }
        
        if (available.length === 1) {
            // Last item automatically becomes a favorite
            addFavorite(available[0]);
            return;
        }
        
        gameState.current = shuffle(available);
        gameState.evaluating = [];
        gameState.survived = [];
        
        loadNextBatch();
    }

    function loadNextBatch() {
        if (gameState.current.length === 0) {
            // Round complete - prepare next round with survivors
            finalizeRound();
            return;
        }
        
        const batchSize = Math.min(BATCH_SIZE, gameState.current.length);
        gameState.evaluating = gameState.current.splice(0, batchSize);
        gameState.timer = 15;
        
        renderBatch();
        startTimer();
        updateUI();
    }

    function finalizeRound() {
        if (gameState.survived.length === 1) {
            // Single survivor becomes next favorite
            addFavorite(gameState.survived[0]);
            return;
        }
        
        if (gameState.survived.length === 0) {
            // Shouldn't happen, but just in case
            endGame();
            return;
        }
        
        // Start new round with survivors
        gameState.current = shuffle(gameState.survived);
        gameState.survived = [];
        loadNextBatch();
    }

    function addFavorite(itemId) {
        if (gameState.favorites.includes(itemId)) return;
        
        gameState.favorites.push(itemId);
        delete gameState.eliminated[itemId];
        
        // Rescue items that were only eliminated by this favorite
        rescueEligibleItems();
        
        if (gameState.favorites.length >= 5) {
            endGame();
            return;
        }
        
        // Continue with next round
        startNewRound();
    }

    function rescueEligibleItems() {
        const toRescue = [];
        
        Object.keys(gameState.eliminated).forEach(id => {
            const eliminatedBy = gameState.eliminated[id].eliminatedBy || [];
            if (eliminatedBy.length === 0) return;
            
            // If all eliminators are now favorites, rescue this item
            const allAreFavorites = eliminatedBy.every(e => gameState.favorites.includes(e));
            if (allAreFavorites) {
                toRescue.push(id);
            }
        });
        
        toRescue.forEach(id => delete gameState.eliminated[id]);
    }

    function renderBatch() {
        const choicesEl = document.getElementById('choices');
        choicesEl.innerHTML = '';
        
        gameState.evaluating.forEach(activity => {
            const card = document.createElement('div');
            card.className = 'choice-card';
            card.textContent = activity;
            // Store the ID for easy lookup
            card.dataset.activityId = activity; 
            card.onclick = () => selectActivity(activity, card);
            choicesEl.appendChild(card);
        });
    }

    function selectActivity(activity, element) {
        stopTimer();
        
        // --- 1. Calculate Score ---
        const timeBonus = Math.floor(gameState.timer * 10);
        let points = 100 + timeBonus;
        const multipliers = [];

        // Combo (time > 10)
        if (gameState.timer > 10) {
            points += 250;
            multipliers.push('COMBO!');
        }

        // Critical hit (ends in 0 or 5)
        const timeStr = gameState.timer.toFixed(2);
        const lastDigit = timeStr[timeStr.length - 1];
        if (lastDigit === '0' || lastDigit === '5') {
            points += 500;
            multipliers.push('CRITICAL!');
        }

        // 6-7 bonus
        if (timeStr.includes('6') && timeStr.includes('7')) {
            points += 777;
            multipliers.push('6-7 BONUS!');
        }

        // Random bonuses
        if (Math.random() > 0.7) {
            points += Math.floor(Math.random() * 300);
            multipliers.push('LUCKY!');
        }

        gameState.score += points;
        
        // --- 2. Update Game State ---
        gameState.survived.push(activity);
        
        // Losers are eliminated
        const losers = gameState.evaluating.filter(a => a !== activity);
        losers.forEach(loser => {
            if (!gameState.eliminated[loser]) {
                gameState.eliminated[loser] = { eliminatedBy: [] };
            }
            if (!gameState.eliminated[loser].eliminatedBy.includes(activity)) {
                gameState.eliminated[loser].eliminatedBy.push(activity);
            }
        });

        // Clear evaluating
        gameState.evaluating = [];

        // --- 3. Show Effects ---
        showMultipliers(multipliers);
        createExplosion(element);
        showFloatingScore(element, points); // NEW: Show floating score
        
        // NEW: Make ALL cards disappear simultaneously
        document.querySelectorAll('.choice-card').forEach(card => {
            card.style.opacity = '0';
            card.style.pointerEvents = 'none'; // Prevent further clicks
        });

        setTimeout(() => {
            loadNextBatch();
        }, 1500); // Wait for the animation to finish
    }

    // NEW FUNCTION
    function showFloatingScore(element, points) {
        const rect = element.getBoundingClientRect();
        const scoreEl = document.createElement('div');
        scoreEl.className = 'floating-score';
        scoreEl.textContent = `+${points}`;
        
        // Position it relative to the viewport (fixed)
        scoreEl.style.left = (rect.right - 10) + 'px'; 
        scoreEl.style.top = (rect.top + 10) + 'px';
        
        document.body.appendChild(scoreEl);
        
        // Remove after animation completes
        setTimeout(() => scoreEl.remove(), 1000);
    }

    function createExplosion(element) {
        const explosions = ['ðŸ’¥', 'âš¡', 'ðŸŒŸ', 'ðŸ’«', 'âœ¨'];
        const rect = element.getBoundingClientRect();
        
        for (let i = 0; i < 5; i++) {
            const explosion = document.createElement('div');
            explosion.className = 'explosion';
            explosion.textContent = explosions[Math.floor(Math.random() * explosions.length)];
            // Position relative to the whole body
            explosion.style.position = 'fixed'; 
            explosion.style.left = (rect.left + Math.random() * rect.width) + 'px';
            explosion.style.top = (rect.top + Math.random() * rect.height) + 'px';
            document.body.appendChild(explosion);
            
            setTimeout(() => explosion.remove(), 600);
        }
        
        // The disappearance is now handled by the .choice-card opacity transition
        // element.style.opacity = '0'; // Removed for simultaneous effect
    }

    function showMultipliers(multipliers) {
        const multipliersEl = document.getElementById('multipliers');
        multipliersEl.innerHTML = '';
        
        multipliers.forEach((text, i) => {
            setTimeout(() => {
                const mult = document.createElement('div');
                mult.className = 'multiplier';
                mult.textContent = text;
                multipliersEl.appendChild(mult);
                
                setTimeout(() => mult.remove(), 2000);
            }, i * 200);
        });
    }

    function startTimer() {
        const timerEl = document.getElementById('timer');
        gameState.timerInterval = setInterval(() => {
            gameState.timer -= 0.01;
            
            if (gameState.timer <= 0) {
                gameState.timer = 0;
                stopTimer();
                // Auto-select random choice
                const randomActivity = gameState.evaluating[Math.floor(Math.random() * gameState.evaluating.length)];
                
                // Find the corresponding card element
                const choices = document.getElementById('choices');
                const randomCard = Array.from(choices.children).find(card => card.dataset.activityId === randomActivity);
                
                if (randomCard) {
                    selectActivity(randomActivity, randomCard);
                } else {
                     // Fallback in case of error
                    console.error("Could not find card for random selection.");
                    loadNextBatch();
                }
            }
            
            timerEl.textContent = gameState.timer.toFixed(2);
            timerEl.className = 'timer-display';
            if (gameState.timer < 5) timerEl.className += ' danger';
            else if (gameState.timer < 10) timerEl.className += ' warning';
        }, 10);
    }

    function stopTimer() {
        if (gameState.timerInterval) {
            clearInterval(gameState.timerInterval);
            gameState.timerInterval = null;
        }
    }

    function updateUI() {
        const available = getAvailableItems();
        const remaining = available.length;
        
        document.getElementById('score').textContent = `SCORE: ${gameState.score}`;
        document.getElementById('remainingCount').textContent = remaining;
        document.getElementById('favsCount').textContent = gameState.favorites.length;
        
        if (remaining > 10) {
            document.getElementById('progressText').textContent = 
                `${remaining} ACTIVITIES REMAINING!`;
        } else if (remaining > 5) {
            document.getElementById('progressText').textContent = 
                `FINAL ${remaining}! GETTING CLOSE!`;
        } else {
            document.getElementById('progressText').textContent = 
                `ALMOST THERE! ${5 - gameState.favorites.length} MORE PICKS!`;
        }
    }

    function endGame() {
        stopTimer();
        document.getElementById('gameScreen').style.display = 'none';
        document.getElementById('resultsScreen').classList.add('active');
        
        document.getElementById('finalScore').textContent = gameState.score;
        document.getElementById('playerNameDisplay').textContent = gameState.playerName;
        
        // Show top picks
        const topPicksList = document.getElementById('topPicksList');
        topPicksList.innerHTML = '';
        gameState.favorites.forEach(pick => {
            const li = document.createElement('li');
            li.textContent = pick;
            topPicksList.appendChild(li);
        });
        
        // Update high scores
        gameState.highScores.push({ 
            name: gameState.playerName, 
            score: gameState.score 
        });
        gameState.highScores.sort((a, b) => b.score - a.score);
        gameState.highScores = gameState.highScores.slice(0, 8);
        
        // Display high scores
        const highScoresList = document.getElementById('highScoresList');
        highScoresList.innerHTML = '';
        gameState.highScores.forEach((entry, i) => {
            const div = document.createElement('div');
            div.className = 'high-score-entry';
            div.innerHTML = `<span>${i + 1}. ${entry.name}</span><span>${entry.score}</span>`;
            highScoresList.appendChild(div);
        });
        
        // Submit to Google Form
        submitToGoogleForm();
    }

    function submitToGoogleForm() {
        // Create URL-encoded form data
        const params = new URLSearchParams();
        params.append('name', gameState.playerName);
        params.append('score', gameState.score);
        params.append('picks', gameState.favorites.join(', '));
        
        fetch(GOOGLE_SHEET_URL + '?' + params.toString(), {
            method: 'GET',
            mode: 'no-cors'
        }).catch(err => console.log('Form submission:', err));
    }

    async function shareScore() {
        const screenshotArea = document.getElementById('screenshotArea');
        
        try {
            const canvas = await html2canvas(screenshotArea, {
                backgroundColor: '#0d2847',
                scale: 2
            });
            
            canvas.toBlob(async (blob) => {
                const file = new File([blob], 'fhe-score.png', { type: 'image/png' });
                
                if (navigator.share && navigator.canShare({ files: [file] })) {
                    await navigator.share({
                        files: [file],
                        title: 'My FHE Fighter Score!',
                        text: `I scored ${gameState.score} points in FHE Fighter II!`
                    });
                } else {
                    // Fallback: download the image
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'fhe-fighter-score.png';
                    a.click();
                    URL.revokeObjectURL(url);
                    alert('Screenshot saved! Share it with your friends!');
                }
            });
        } catch (err) {
            console.error('Screenshot failed:', err);
            alert('Could not create screenshot. Try taking a screenshot manually!');
        }
    }

    function resetGame() {
        gameState = {
            playerName: '',
            score: 0,
            current: [],
            evaluating: [],
            survived: [],
            eliminated: {},
            favorites: [],
            timer: 15,
            timerInterval: null,
            highScores: gameState.highScores
        };
        
        document.getElementById('resultsScreen').classList.remove('active');
        document.getElementById('nameInputScreen').style.display = 'block';
        document.getElementById('playerName').value = '';
        document.getElementById('multipliers').innerHTML = '';
        document.getElementById('gameScreen').style.display = 'none'; // Ensure game screen is hidden
    }
    </script>
</body>
</html>
