<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pok√©mon Type Quiz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .pixelated {
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }
    </style>
</head>
<body class="bg-gradient-to-b from-blue-100 to-blue-200 min-h-screen">
    <div id="app"></div>

    <script>
        // üîß PASTE YOUR GOOGLE SHEETS WEBHOOK URL HERE:
        const GOOGLE_SHEET_URL = 'https://script.google.com/macros/s/AKfycbxya77jjiWfTLhXcFJcwSV70ytLXfr4Ok9cOlkrKvBgfY5Mq2vMQ2CqjPooBQTg5ZNOVw/exec';

        // üîß PASTE YOUR CSV DATA HERE (no header row):
        const POKEMON_CSV = `1,Bulbasaur,Grass,Poison,1
2,Ivysaur,Grass,Poison,1
3,Venusaur,Grass,Poison,1
4,Charmander,Fire,,1
5,Charmeleon,Fire,,1
6,Charizard,Fire,Flying,1
7,Squirtle,Water,,1
8,Wartortle,Water,,1
9,Blastoise,Water,,1
10,Caterpie,Bug,,1
11,Metapod,Bug,,1
12,Butterfree,Bug,Flying,1
13,Weedle,Bug,Poison,1
14,Kakuna,Bug,Poison,1
15,Beedrill,Bug,Poison,1
16,Pidgey,Normal,Flying,1
17,Pidgeotto,Normal,Flying,1
18,Pidgeot,Normal,Flying,1
19,Rattata,Normal,,1
20,Raticate,Normal,,1
21,Spearow,Normal,Flying,1
22,Fearow,Normal,Flying,1
23,Ekans,Poison,,1
24,Arbok,Poison,,1
25,Pikachu,Electric,,1
26,Raichu,Electric,,1
27,Sandshrew,Ground,,1
28,Sandslash,Ground,,1
29,Nidoran‚ôÄ,Poison,,1
30,Nidorina,Poison,,1
31,Nidoqueen,Poison,Ground,1
32,Nidoran‚ôÇ,Poison,,1
33,Nidorino,Poison,,1
34,Nidoking,Poison,Ground,1
35,Clefairy,Normal,,1
36,Clefable,Normal,,1
37,Vulpix,Fire,,1
38,Ninetales,Fire,,1
39,Jigglypuff,Normal,,1
40,Wigglytuff,Normal,,1
41,Zubat,Poison,Flying,1
42,Golbat,Poison,Flying,1
43,Oddish,Grass,Poison,1
44,Gloom,Grass,Poison,1
45,Vileplume,Grass,Poison,1
46,Paras,Bug,Grass,1
47,Parasect,Bug,Grass,1
48,Venonat,Bug,Poison,1
49,Venomoth,Bug,Poison,1
50,Diglett,Ground,,1
51,Dugtrio,Ground,,1
52,Meowth,Normal,,1
53,Persian,Normal,,1
54,Psyduck,Water,,1
55,Golduck,Water,,1
56,Mankey,Fighting,,1
57,Primeape,Fighting,,1
58,Growlithe,Fire,,1
59,Arcanine,Fire,,1
60,Poliwag,Water,,1
61,Poliwhirl,Water,,1
62,Poliwrath,Water,Fighting,1
63,Abra,Psychic,,1
64,Kadabra,Psychic,,1
65,Alakazam,Psychic,,1
66,Machop,Fighting,,1
67,Machoke,Fighting,,1
68,Machamp,Fighting,,1
69,Bellsprout,Grass,Poison,1
70,Weepinbell,Grass,Poison,1
71,Victreebel,Grass,Poison,1
72,Tentacool,Water,Poison,1
73,Tentacruel,Water,Poison,1
74,Geodude,Rock,Ground,1
75,Graveler,Rock,Ground,1
76,Golem,Rock,Ground,1
77,Ponyta,Fire,,1
78,Rapidash,Fire,,1
79,Slowpoke,Water,Psychic,1
80,Slowbro,Water,Psychic,1
81,Magnemite,Electric,,1
82,Magneton,Electric,,1
83,Farfetch'd,Normal,Flying,1
84,Doduo,Normal,Flying,1
85,Dodrio,Normal,Flying,1
86,Seel,Water,,1
87,Dewgong,Water,Ice,1
88,Grimer,Poison,,1
89,Muk,Poison,,1
90,Shellder,Water,,1
91,Cloyster,Water,Ice,1
92,Gastly,Ghost,Poison,1
93,Haunter,Ghost,Poison,1
94,Gengar,Ghost,Poison,1
95,Onix,Rock,Ground,1
96,Drowzee,Psychic,,1
97,Hypno,Psychic,,1
98,Krabby,Water,,1
99,Kingler,Water,,1
100,Voltorb,Electric,,1
101,Electrode,Electric,,1
102,Exeggcute,Grass,Psychic,1
103,Exeggutor,Grass,Psychic,1
104,Cubone,Ground,,1
105,Marowak,Ground,,1
106,Hitmonlee,Fighting,,1
107,Hitmonchan,Fighting,,1
108,Lickitung,Normal,,1
109,Koffing,Poison,,1
110,Weezing,Poison,,1
111,Rhyhorn,Ground,Rock,1
112,Rhydon,Ground,Rock,1
113,Chansey,Normal,,1
114,Tangela,Grass,,1
115,Kangaskhan,Normal,,1
116,Horsea,Water,,1
117,Seadra,Water,,1
118,Goldeen,Water,,1
119,Seaking,Water,,1
120,Staryu,Water,,1
121,Starmie,Water,Psychic,1
122,Mr. Mime,Psychic,,1
123,Scyther,Bug,Flying,1
124,Jynx,Ice,Psychic,1
125,Electabuzz,Electric,,1
126,Magmar,Fire,,1
127,Pinsir,Bug,,1
128,Tauros,Normal,,1
129,Magikarp,Water,,1
130,Gyarados,Water,Flying,1
131,Lapras,Water,Ice,1
132,Ditto,Normal,,1
133,Eevee,Normal,,1
134,Vaporeon,Water,,1
135,Jolteon,Electric,,1
136,Flareon,Fire,,1
137,Porygon,Normal,,1
138,Omanyte,Rock,Water,1
139,Omastar,Rock,Water,1
140,Kabuto,Rock,Water,1
141,Kabutops,Rock,Water,1
142,Aerodactyl,Rock,Flying,1
143,Snorlax,Normal,,1
144,Articuno,Ice,Flying,1
145,Zapdos,Electric,Flying,1
146,Moltres,Fire,Flying,1
147,Dratini,Dragon,,1
148,Dragonair,Dragon,,1
149,Dragonite,Dragon,Flying,1
150,Mewtwo,Psychic,,1
151,Mew,Psychic,,1`;

        // üîß SPRITE MODE: 'gbc', 'gb', '3d', 'card', or 'moves'
        let spriteMode = 'gbc';

        // Get file extension based on sprite mode
        function getSpriteExtension(mode) {
            if (mode === '3d') return 'webm';
            if (mode === 'card' || mode === 'moves') return 'webp';
            return 'png';
        }

        // Get sprite mode display name
        function getSpriteModeLabel(mode) {
            const labels = {
                'gbc': 'Color',
                'gb': 'Grayscale',
                '3d': '3D',
                'card': 'Card',
                'moves': 'Moves'
            };
            return labels[mode] || mode;
        }

        // Parse CSV into Pokemon data
        function parsePokemonData(csv) {
            const lines = csv.trim().split('\n');
            return lines.map(line => {
                const [id, name, type1, type2, gen] = line.split(',');
                const types = [type1.toLowerCase()];
                if (type2 && type2.trim()) {
                    types.push(type2.toLowerCase());
                }
                const ext = getSpriteExtension(spriteMode);
                return {
                    id: parseInt(id),
                    name: name,
                    types: types,
                    gen: parseInt(gen),
                    sprite: `images/${spriteMode}/${id}.${ext}`
                };
            });
        }

        const POKEMON_DATA = parsePokemonData(POKEMON_CSV);

        const TYPE_COLORS = {
            normal: 'bg-gray-400',
            fire: 'bg-red-500',
            water: 'bg-blue-500',
            electric: 'bg-yellow-400',
            grass: 'bg-green-500',
            ice: 'bg-cyan-400',
            fighting: 'bg-orange-600',
            poison: 'bg-purple-500',
            ground: 'bg-amber-700',
            flying: 'bg-blue-300',
            psychic: 'bg-pink-500',
            bug: 'bg-lime-500',
            rock: 'bg-yellow-700',
            ghost: 'bg-purple-700',
            dragon: 'bg-indigo-600'
        };

        const types = ['bug', 'poison', 'ground', 'flying', 'electric', 'rock', 'normal', 'grass', 'fire', 'dragon', 'psychic', 'ice', 'ghost', 'fighting', 'water'];

        let quizPokemon = [];
        let currentIndex = 0;
        let selectedTypes = [];
        let results = [];
        let screen = 'quiz';

        function calculateScore(correctTypes, userTypes) {
            let points = 0;
            const hasOneType = correctTypes.length === 1;
            const hasTwoTypes = correctTypes.length === 2;

            // Count correct and wrong guesses
            const correctGuesses = userTypes.filter(ut => correctTypes.includes(ut)).length;
            const wrongGuesses = userTypes.filter(ut => !correctTypes.includes(ut)).length;
            
            // Award points for correct types, subtract for wrong types
            points = correctGuesses - wrongGuesses;

            // If they got at least 1 correct, minimum 1 point (partial credit)
            if (correctGuesses > 0 && points < 1) {
                points = 1;
            }

            // Bonus point for perfect identification
            if (hasOneType && correctGuesses === 1 && wrongGuesses === 0) {
                points += 1; // Bonus for single-type with no wrong guesses
            } else if (hasTwoTypes && correctGuesses === 2 && wrongGuesses === 0) {
                points += 1; // Bonus for getting both types correct with no wrong guesses
            }

            return Math.max(0, points); // Don't go below 0
        }

        function initQuiz() {
            // Reparse pokemon data with current sprite mode
            const allPokemon = parsePokemonData(POKEMON_CSV);
            const shuffled = [...allPokemon].sort(() => Math.random() - 0.5);
            quizPokemon = shuffled.slice(0, 5);
            currentIndex = 0;
            selectedTypes = [];
            results = [];
            screen = 'quiz';
            render();
        }

        function setSpriteMode(mode) {
            spriteMode = mode;
            initQuiz(); // Reset quiz when changing sprite mode
        }

        function toggleType(type) {
            if (selectedTypes.includes(type)) {
                selectedTypes = selectedTypes.filter(t => t !== type);
            } else if (selectedTypes.length < 2) {
                selectedTypes.push(type);
            }
            render();
        }

        function submitAnswer() {
            if (selectedTypes.length === 0) return;

            const currentPokemon = quizPokemon[currentIndex];
            const correctTypes = currentPokemon.types.sort();
            const userTypes = [...selectedTypes].sort();
            const points = calculateScore(correctTypes, userTypes);

            results.push({
                pokemon: currentPokemon.name,
                correctTypes: correctTypes.join(', '),
                userTypes: userTypes.join(', '),
                points: points
            });

            selectedTypes = [];

            if (currentIndex < quizPokemon.length - 1) {
                currentIndex++;
                render();
            } else {
                submitToGoogleSheets();
            }
        }

        async function submitToGoogleSheets() {
            screen = 'submitting';
            render();

            const totalPoints = results.reduce((sum, r) => sum + r.points, 0);
            const maxPoints = quizPokemon.reduce((sum, p) => sum + (p.types.length === 1 ? 2 : 3), 0);

            const data = {
                timestamp: new Date().toISOString(),
                spriteMode: spriteMode,
                totalPoints: totalPoints,
                maxPoints: maxPoints,
                percentage: Math.round((totalPoints / maxPoints) * 100),
                responses: results
            };

            try {
                await fetch(GOOGLE_SHEET_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });

                setTimeout(() => {
                    screen = 'complete';
                    render();
                }, 200);
            } catch (error) {
                console.error('Error submitting:', error);
                setTimeout(() => {
                    screen = 'complete';
                    render();
                }, 200);
            }
        }

        function render() {
            const app = document.getElementById('app');

            if (screen === 'submitting') {
                app.innerHTML = `
                    <div class="min-h-screen p-8 flex items-center justify-center">
                        <div class="max-w-md w-full bg-white rounded-lg shadow-xl p-8 text-center">
                            <div class="animate-spin rounded-full h-16 w-16 border-b-4 border-blue-500 mx-auto mb-4"></div>
                            <p class="text-xl text-gray-700">Analyzing your quiz results‚Äîstand by, Trainer!</p>
                        </div>
                    </div>
                `;
                return;
            }

            if (screen === 'complete') {
                const totalPoints = results.reduce((sum, r) => sum + r.points, 0);
                const maxPoints = quizPokemon.reduce((sum, p) => sum + (p.types.length === 1 ? 2 : 3), 0);

                app.innerHTML = `
                    <div class="min-h-screen p-8 flex items-center justify-center">
                        <div class="max-w-md w-full bg-white rounded-lg shadow-xl p-8">
                            <div class="text-center">
                                <div class="text-6xl mb-4">‚úì</div>
                                <h1 class="text-3xl font-bold text-green-600 mb-4">Evaluation Complete</h1>
                                <p class="text-gray-600 mb-6">Your Trainer Rank has been recorded.</p>
                                
                                <div class="bg-blue-50 p-6 rounded-lg mb-6">
                                    <p class="text-lg text-gray-700 mb-2">Your Score:</p>
                                    <p class="text-4xl font-bold text-blue-600">${totalPoints}/${maxPoints}</p>
                                    <p class="text-gray-600 mt-2">${Math.round((totalPoints/maxPoints) * 100)}%</p>
                                </div>

                                <button onclick="initQuiz()" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-lg">
                                    Take Quiz Again
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                return;
            }

            const currentPokemon = quizPokemon[currentIndex];

            app.innerHTML = `
                <div class="min-h-screen p-4">
                    <div class="max-w-4xl mx-auto">
                        <div class="bg-white rounded-lg shadow-xl p-8">
                            <h1 class="text-3xl font-bold text-center mb-4 text-blue-900">Pok√©mon Type Quiz</h1>
                            
                            <div class="flex justify-center gap-2 mb-6 flex-wrap">
                                <button 
                                    onclick="setSpriteMode('gbc')"
                                    class="${spriteMode === 'gbc' ? 'bg-blue-600' : 'bg-blue-400'} hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg text-sm transition-colors"
                                >
                                    Color
                                </button>
                                <button 
                                    onclick="setSpriteMode('gb')"
                                    class="${spriteMode === 'gb' ? 'bg-gray-600' : 'bg-gray-400'} hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg text-sm transition-colors"
                                >
                                    Grayscale
                                </button>
                                <button 
                                    onclick="setSpriteMode('3d')"
                                    class="${spriteMode === '3d' ? 'bg-purple-600' : 'bg-purple-400'} hover:bg-purple-600 text-white font-bold py-2 px-4 rounded-lg text-sm transition-colors"
                                >
                                    3D
                                </button>
                                <button 
                                    onclick="setSpriteMode('card')"
                                    class="${spriteMode === 'card' ? 'bg-green-600' : 'bg-green-400'} hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg text-sm transition-colors"
                                >
                                    Card
                                </button>
                                <button 
                                    onclick="setSpriteMode('moves')"
                                    class="${spriteMode === 'moves' ? 'bg-orange-600' : 'bg-orange-400'} hover:bg-orange-600 text-white font-bold py-2 px-4 rounded-lg text-sm transition-colors"
                                >
                                    Moves
                                </button>
                            </div>
                            
                            <p class="text-center text-gray-600 mb-6">
                            Select up to 2 categories (elemental types) for each Pok√©mon. 1 point for each correct category. Bonus points are rewarded for perfect single category or dual category matches.
                            </p>
                            
                            <div class="text-center mb-4 text-sm text-gray-500">
                                Question ${currentIndex + 1} of ${quizPokemon.length}
                            </div>

                            <div class="flex flex-col items-center mb-8">
                                ${spriteMode === '3d' 
                                    ? `<video 
                                        src="${currentPokemon.sprite}" 
                                        loop 
                                        muted
                                        playsinline
                                        onmouseenter="this.play()"
                                        onmouseleave="this.pause()"
                                        ontouchstart="this.play()"
                                        onloadeddata="if(window.matchMedia('(hover: none)').matches) this.play()"
                                       
                                        class="w-[300px] h-[300px] max-w-full max-h-[300px] cursor-pointer"
                                    ></video>`
                                    : spriteMode === 'card'
                                    ? `<img 
                                        src="${currentPokemon.sprite}" 
                                        alt="${currentPokemon.name}"
                                        class="h-[400px] w-auto max-h-[70vh] max-w-full object-contain"
                                    />`
                                    : spriteMode === 'moves'
                                    ? `<img 
                                        src="${currentPokemon.sprite}" 
                                        alt="${currentPokemon.name}"
                                        class="h-[500px] w-auto max-h-[70vh] max-w-full object-contain"
                                    />`
                                    : `<img 
                                        src="${currentPokemon.sprite}" 
                                        alt="${currentPokemon.name}"
                                        class="w-48 h-48 pixelated"
                                    />`
                                }
                                <h2 class="text-2xl font-bold text-gray-800 mt-4">${currentPokemon.name}</h2>
                            </div>

                            <div class="grid grid-cols-3 gap-4 mb-8">
                                ${types.map(type => `
                                    <button 
                                        onclick="toggleType('${type}')"
                                        class="${TYPE_COLORS[type]} ${selectedTypes.includes(type) ? 'ring-4 ring-yellow-400' : ''} text-white font-bold py-3 px-6 rounded-full uppercase text-sm transition-all hover:scale-105"
                                    >
                                        ${type}
                                    </button>
                                `).join('')}
                            </div>

                            <div class="text-center mb-4">
                                <p class="text-gray-600">
                                    Selected: ${selectedTypes.length}/2
                                    ${selectedTypes.length > 0 ? `<span class="ml-2 font-semibold">(${selectedTypes.join(', ')})</span>` : ''}
                                </p>
                            </div>

                            <button
                                onclick="submitAnswer()"
                                ${selectedTypes.length === 0 ? 'disabled' : ''}
                                class="w-full font-bold py-4 px-6 rounded-lg text-white text-lg ${
                                    selectedTypes.length === 0
                                        ? 'bg-gray-400 cursor-not-allowed'
                                        : 'bg-blue-500 hover:bg-blue-600'
                                }"
                            >
                                ${currentIndex < quizPokemon.length - 1 ? 'Next Pok√©mon' : 'Submit Quiz'}
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        // Start the quiz when page loads
        window.onload = initQuiz;
    </script>
</body>
</html>